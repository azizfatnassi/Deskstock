<div class="admin-users-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-btn" (click)="goBackToDashboard()" title="Back to Dashboard">
        <i class="fas fa-arrow-left"></i>
        Dashboard
      </button>
      <h1>User Management</h1>
      <button class="add-btn" (click)="showAddUser()" [disabled]="isLoading">
        <i class="fas fa-plus"></i>
        Add New User
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search users by name or email..." 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
      >
    </div>
    
    <div class="filter-group">
      <label>Role:</label>
      <select [(ngModel)]="selectedRole" (change)="onRoleFilterChange()">
        <option value="">All Roles</option>
        <option value="ADMIN">Admin</option>
        <option value="USER">User</option>
      </select>
    </div>
  </div>

  <!-- Messages -->
  <div class="messages" *ngIf="error || successMessage">
    <div class="alert alert-success" *ngIf="successMessage">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
    </div>
    <div class="alert alert-error" *ngIf="error">
      <i class="fas fa-exclamation-circle"></i>
      {{ error }}
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Users Table -->
  <div class="table-container" *ngIf="!isLoading">
    <table class="users-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUsers" class="user-row">
          <td class="user-name">
            <div class="user-avatar">
              <i class="fas fa-user"></i>
            </div>
            <span>{{ user.name }}</span>
          </td>
          <td class="user-email">{{ user.email }}</td>
          <td class="user-role">
            <span class="role-badge" [class]="'role-' + user.role.toLowerCase()">
              {{ user.role }}
            </span>
          </td>
          <td class="user-created">{{ user.createdAt | date:'short' }}</td>
          <td class="user-actions">
            <button 
              class="action-btn edit" 
              (click)="editUser(user)" 
              [disabled]="isUpdating || isDeleting"
              title="Edit User"
            >
              <i class="fas fa-edit"></i>
              Edit
            </button>
            <button 
              class="action-btn delete" 
              (click)="deleteUser(user)" 
              [disabled]="isUpdating || isDeleting"
              title="Delete User"
            >
              <i class="fas fa-trash"></i>
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredUsers.length === 0">
      <i class="fas fa-users"></i>
      <h3>No users found</h3>
      <p>Try adjusting your filters or start by adding your first user</p>
      <button class="add-btn" (click)="showAddUser()">
        Add First User
      </button>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!isLoading && filteredUsers.length > 0">
    <button 
      class="page-btn" 
      (click)="prevPage()" 
      [disabled]="currentPage === 1"
    >
      <i class="fas fa-chevron-left"></i>
    </button>
    
    <span class="page-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    
    <button 
      class="page-btn" 
      (click)="nextPage()" 
      [disabled]="currentPage === totalPages"
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

<!-- Add User Modal -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="cancelAdd()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Add New User</h2>
      <button class="close-btn" (click)="cancelAdd()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form [formGroup]="addUserForm" (ngSubmit)="createUser()" class="user-form">
      <div class="form-group">
        <label for="addName">Name *</label>
        <input 
          id="addName"
          type="text" 
          formControlName="name" 
          placeholder="Enter user name"
          [class.error]="addUserForm.get('name')?.invalid && addUserForm.get('name')?.touched"
        >
        <div class="error-message" *ngIf="addUserForm.get('name')?.invalid && addUserForm.get('name')?.touched">
          <span *ngIf="addUserForm.get('name')?.errors?.['required']">Name is required</span>
          <span *ngIf="addUserForm.get('name')?.errors?.['minlength']">Name must be at least 2 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="addEmail">Email *</label>
        <input 
          id="addEmail"
          type="email" 
          formControlName="email" 
          placeholder="Enter email address"
          [class.error]="addUserForm.get('email')?.invalid && addUserForm.get('email')?.touched"
        >
        <div class="error-message" *ngIf="addUserForm.get('email')?.invalid && addUserForm.get('email')?.touched">
          <span *ngIf="addUserForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="addUserForm.get('email')?.errors?.['email']">Please enter a valid email</span>
        </div>
      </div>

      <div class="form-group">
        <label for="addPassword">Password *</label>
        <input 
          id="addPassword"
          type="password" 
          formControlName="password" 
          placeholder="Enter password"
          [class.error]="addUserForm.get('password')?.invalid && addUserForm.get('password')?.touched"
        >
        <div class="error-message" *ngIf="addUserForm.get('password')?.invalid && addUserForm.get('password')?.touched">
          <span *ngIf="addUserForm.get('password')?.errors?.['required']">Password is required</span>
          <span *ngIf="addUserForm.get('password')?.errors?.['minlength']">Password must be at least 6 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="addRole">Role *</label>
        <select id="addRole" formControlName="role">
          <option value="USER">User</option>
          <option value="ADMIN">Admin</option>
        </select>
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" (click)="cancelAdd()" [disabled]="isCreating">
          Cancel
        </button>
        <button 
          type="submit" 
          class="create-btn" 
          [disabled]="addUserForm.invalid || isCreating"
        >
          <span *ngIf="isCreating">Creating...</span>
          <span *ngIf="!isCreating">Create User</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="cancelEdit()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Edit User</h2>
      <button class="close-btn" (click)="cancelEdit()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form [formGroup]="editUserForm" (ngSubmit)="updateUser()" class="user-form">
      <div class="form-group">
        <label for="editName">Name *</label>
        <input 
          id="editName"
          type="text" 
          formControlName="name" 
          placeholder="Enter user name"
          [class.error]="editUserForm.get('name')?.invalid && editUserForm.get('name')?.touched"
        >
        <div class="error-message" *ngIf="editUserForm.get('name')?.invalid && editUserForm.get('name')?.touched">
          <span *ngIf="editUserForm.get('name')?.errors?.['required']">Name is required</span>
          <span *ngIf="editUserForm.get('name')?.errors?.['minlength']">Name must be at least 2 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editEmail">Email *</label>
        <input 
          id="editEmail"
          type="email" 
          formControlName="email" 
          placeholder="Enter email address"
          [class.error]="editUserForm.get('email')?.invalid && editUserForm.get('email')?.touched"
        >
        <div class="error-message" *ngIf="editUserForm.get('email')?.invalid && editUserForm.get('email')?.touched">
          <span *ngIf="editUserForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="editUserForm.get('email')?.errors?.['email']">Please enter a valid email</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editRole">Role *</label>
        <select id="editRole" formControlName="role">
          <option value="USER">User</option>
          <option value="ADMIN">Admin</option>
        </select>
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" (click)="cancelEdit()" [disabled]="isUpdating">
          Cancel
        </button>
        <button 
          type="submit" 
          class="update-btn" 
          [disabled]="editUserForm.invalid || isUpdating"
        >
          <span *ngIf="isUpdating">Updating...</span>
          <span *ngIf="!isUpdating">Update User</span>
        </button>
      </div>
    </form>
  </div>
</div>