<div class="admin-statistics">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button class="back-btn" (click)="navigateToDashboard()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5m7-7l-7 7 7 7"></path>
        </svg>
        Back to Dashboard
      </button>
      <h1>Statistics & Analytics</h1>
      <p>Comprehensive insights into your business performance and trends</p>
    </div>
    <div class="header-right">
      <select class="period-select" [(ngModel)]="selectedPeriod" (change)="onPeriodChange()">
        <option *ngFor="let period of periods" [value]="period.value">{{ period.label }}</option>
      </select>
      <button class="refresh-btn" (click)="refreshStatistics()" [disabled]="isLoading">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" [class.spinning]="isLoading">
          <polyline points="23,4 23,10 17,10"></polyline>
          <polyline points="1,20 1,14 7,14"></polyline>
          <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15"></path>
        </svg>
        Refresh
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div class="alert alert-error" *ngIf="error">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    {{ error }}
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading statistics...</p>
  </div>

  <!-- Statistics Content -->
  <div class="statistics-content" *ngIf="!isLoading && statistics">
    <!-- Key Metrics -->
    <div class="metrics-grid">
      <div class="metric-card revenue">
        <div class="metric-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
        </div>
        <div class="metric-content">
          <div class="metric-value">{{ formatCurrency(statistics.totalRevenue) }}</div>
          <div class="metric-label">Total Revenue</div>
          <div class="metric-change positive">+12.5% from last month</div>
        </div>
      </div>

      <div class="metric-card orders">
        <div class="metric-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
          </svg>
        </div>
        <div class="metric-content">
          <div class="metric-value">{{ formatNumber(statistics.totalOrders) }}</div>
          <div class="metric-label">Total Orders</div>
          <div class="metric-change positive">+8.3% from last month</div>
        </div>
      </div>

      <div class="metric-card products">
        <div class="metric-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
          </svg>
        </div>
        <div class="metric-content">
          <div class="metric-value">{{ formatNumber(statistics.totalProducts) }}</div>
          <div class="metric-label">Total Products</div>
          <div class="metric-change neutral">{{ statistics.lowStockProducts }} low stock</div>
        </div>
      </div>

      <div class="metric-card customers">
        <div class="metric-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="metric-content">
          <div class="metric-value">{{ formatNumber(statistics.totalCustomers) }}</div>
          <div class="metric-label">Total Customers</div>
          <div class="metric-change positive">+15.2% from last month</div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container revenue-chart">
        <div class="chart-header">
          <h3>Revenue Trend</h3>
          <div class="chart-legend">
            <span class="legend-item revenue">Revenue</span>
          </div>
        </div>
        <div class="chart-content">
          <div class="simple-chart">
            <div class="chart-bars">
              <div 
                *ngFor="let value of revenueChartData; let i = index" 
                class="chart-bar revenue"
                [style.height.%]="(value / 60000) * 100"
                [title]="chartLabels[i] + ': ' + formatCurrency(value)"
              ></div>
            </div>
            <div class="chart-labels">
              <span *ngFor="let label of chartLabels" class="chart-label">{{ label }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-container orders-chart">
        <div class="chart-header">
          <h3>Orders Trend</h3>
          <div class="chart-legend">
            <span class="legend-item orders">Orders</span>
          </div>
        </div>
        <div class="chart-content">
          <div class="simple-chart">
            <div class="chart-bars">
              <div 
                *ngFor="let value of ordersChartData; let i = index" 
                class="chart-bar orders"
                [style.height.%]="(value / 300) * 100"
                [title]="chartLabels[i] + ': ' + formatNumber(value) + ' orders'"
              ></div>
            </div>
            <div class="chart-labels">
              <span *ngFor="let label of chartLabels" class="chart-label">{{ label }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Tables Section -->
    <div class="data-section">
      <!-- Category Distribution -->
      <div class="data-card category-distribution">
        <div class="card-header">
          <h3>Category Distribution</h3>
          <button class="view-all-btn" (click)="navigateToProducts()">
            View All Products
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9,18 15,12 9,6"></polyline>
            </svg>
          </button>
        </div>
        <div class="category-list">
          <div *ngFor="let category of statistics.categoryDistribution" class="category-item">
            <div class="category-info">
              <span class="category-name">{{ category.name }}</span>
              <span class="category-count">{{ category.value }} products</span>
            </div>
            <div class="category-progress">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="category.percentage"></div>
              </div>
              <span class="category-percentage">{{ category.percentage }}%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Selling Products -->
      <div class="data-card top-products">
        <div class="card-header">
          <h3>Top Selling Products</h3>
          <span class="period-indicator">{{ selectedPeriod === 'month' ? 'This Month' : 'This Period' }}</span>
        </div>
        <div class="products-list">
          <div *ngFor="let product of statistics.topSellingProducts; let i = index" class="product-item">
            <div class="product-rank">{{ i + 1 }}</div>
            <div class="product-info">
              <div class="product-name">{{ product.name }}</div>
              <div class="product-stats">
                <span class="sales-count">{{ product.sales }} sold</span>
                <span class="revenue-amount">{{ formatCurrency(product.revenue) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="data-card recent-activity">
        <div class="card-header">
          <h3>Recent Activity</h3>
          <button class="refresh-btn small" (click)="refreshStatistics()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23,4 23,10 17,10"></polyline>
              <polyline points="1,20 1,14 7,14"></polyline>
              <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15"></path>
            </svg>
          </button>
        </div>
        <div class="activity-list">
          <div *ngFor="let activity of statistics.recentActivity" class="activity-item">
            <div class="activity-icon" [ngClass]="getActivityColor(activity.type)">
              {{ getActivityIcon(activity.type) }}
            </div>
            <div class="activity-content">
              <div class="activity-message">{{ activity.message }}</div>
              <div class="activity-time">{{ getTimeAgo(activity.timestamp) }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stock Alerts -->
    <div class="alerts-section" *ngIf="statistics.lowStockProducts > 0 || statistics.outOfStockProducts > 0">
      <div class="alert-card stock-alert" *ngIf="statistics.lowStockProducts > 0">
        <div class="alert-icon warning">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </div>
        <div class="alert-content">
          <div class="alert-title">Low Stock Alert</div>
          <div class="alert-message">{{ statistics.lowStockProducts }} products are running low on stock</div>
        </div>
        <button class="alert-action" (click)="navigateToProducts()">
          View Products
        </button>
      </div>

      <div class="alert-card stock-alert critical" *ngIf="statistics.outOfStockProducts > 0">
        <div class="alert-icon error">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="alert-content">
          <div class="alert-title">Out of Stock</div>
          <div class="alert-message">{{ statistics.outOfStockProducts }} products are completely out of stock</div>
        </div>
        <button class="alert-action" (click)="navigateToProducts()">
          Restock Now
        </button>
      </div>
    </div>
  </div>
</div>