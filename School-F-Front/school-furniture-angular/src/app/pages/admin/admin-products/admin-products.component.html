<div class="admin-products">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <button class="back-btn" (click)="navigateToDashboard()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5m7-7l-7 7 7 7"></path>
        </svg>
        Back to Dashboard
      </button>
      <h1>Product Management</h1>
    </div>
    
    <div class="header-right">
      <button class="add-btn" (click)="showAddProductForm()" *ngIf="!showAddForm">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="16"></line>
          <line x1="8" y1="12" x2="16" y2="12"></line>
        </svg>
        Add Product
      </button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20,6 9,17 4,12"></polyline>
    </svg>
    {{ successMessage }}
  </div>

  <div class="alert alert-error" *ngIf="error">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    {{ error }}
  </div>

  <!-- Product Form -->
  <div class="product-form-container" *ngIf="showAddForm">
    <div class="form-card">
      <div class="form-header">
        <h2>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h2>
        <button class="close-btn" (click)="cancelForm()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Product Name *</label>
            <input type="text" class="form-input" [class.error]="isFieldInvalid('name')" formControlName="name" placeholder="Enter product name">
            <div class="error-message" *ngIf="isFieldInvalid('name')">
              {{ getFieldError('name') }}
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Category *</label>
            <select class="form-input" [class.error]="isFieldInvalid('category')" formControlName="category">
              <option value="">Select category</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
            <div class="error-message" *ngIf="isFieldInvalid('category')">
              {{ getFieldError('category') }}
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Description *</label>
          <textarea class="form-input" [class.error]="isFieldInvalid('description')" formControlName="description" placeholder="Enter product description" rows="4"></textarea>
          <div class="error-message" *ngIf="isFieldInvalid('description')">
            {{ getFieldError('description') }}
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Price ($) *</label>
            <input type="number" class="form-input" [class.error]="isFieldInvalid('price')" formControlName="price" placeholder="0.00" step="0.01" min="0">
            <div class="error-message" *ngIf="isFieldInvalid('price')">
              {{ getFieldError('price') }}
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Stock Quantity *</label>
            <input type="number" class="form-input" [class.error]="isFieldInvalid('stockQuantity')" formControlName="stockQuantity" placeholder="0" min="0">
            <div class="error-message" *ngIf="isFieldInvalid('stockQuantity')">
              {{ getFieldError('stockQuantity') }}
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Image URL</label>
          <input type="url" class="form-input" formControlName="imageUrl" placeholder="https://example.com/image.jpg">
        </div>
        
        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="cancelForm()" [disabled]="isSubmitting">
            Cancel
          </button>
          <button type="submit" class="submit-btn" [disabled]="isSubmitting || productForm.invalid">
            <div class="btn-content" *ngIf="!isSubmitting">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20,6 9,17 4,12"></polyline>
              </svg>
              {{ editingProduct ? 'Update Product' : 'Create Product' }}
            </div>
            <div class="btn-loading" *ngIf="isSubmitting">
              <div class="spinner"></div>
              {{ editingProduct ? 'Updating...' : 'Creating...' }}
            </div>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Products List -->
  <div class="products-container" *ngIf="!showAddForm">
    <!-- Filters -->
    <div class="filters-section">
      <div class="search-group">
        <div class="search-input-wrapper">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
          </svg>
          <input type="text" class="search-input" placeholder="Search products..." [(ngModel)]="searchTerm" (input)="onSearchChange()">
        </div>
      </div>
      
      <div class="filter-group">
        <select class="filter-select" [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
          <option value="">All Categories</option>
          <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
        </select>
        
        <select class="filter-select" [(ngModel)]="stockFilter" (change)="onStockFilterChange()">
          <option value="all">All Stock Levels</option>
          <option value="low">Low Stock</option>
          <option value="out">Out of Stock</option>
        </select>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading products...</p>
    </div>

    <!-- Products Table -->
    <div class="products-table-container" *ngIf="!isLoading">
      <div class="table-header">
        <h3>Products ({{ filteredProducts.length }})</h3>
      </div>
      
      <div class="products-table" *ngIf="filteredProducts.length > 0">
        <div class="table-header-row">
          <div class="table-cell header">Product</div>
          <div class="table-cell header">Category</div>
          <div class="table-cell header">Price</div>
          <div class="table-cell header">Stock</div>
          <div class="table-cell header">Status</div>
          <div class="table-cell header">Actions</div>
        </div>
        
        <div class="table-row" *ngFor="let product of getPaginatedProducts()">
          <div class="table-cell product-info">
            <div class="product-image" *ngIf="product.imageUrl">
              <img [src]="product.imageUrl" [alt]="product.name" onerror="this.style.display='none'">
            </div>
            <div class="product-image placeholder" *ngIf="!product.imageUrl">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21,15 16,10 5,21"></polyline>
              </svg>
            </div>
            <div class="product-details">
              <div class="product-name">{{ product.name }}</div>
              <div class="product-description">{{ product.description | slice:0:60 }}{{ product.description.length > 60 ? '...' : '' }}</div>
            </div>
          </div>
          
          <div class="table-cell">{{ product.category }}</div>
          <div class="table-cell price">${{ product.price | number:'1.2-2' }}</div>
          
          <div class="table-cell stock-cell">
            <input type="number" class="stock-input" [value]="product.stockQuantity" (blur)="updateStock(product, ($event.target as HTMLInputElement)?.value || 0)" min="0">
          </div>
          
          <div class="table-cell">
            <span class="status-badge" [class]="getStockStatus(product.stockQuantity)">
              {{ getStockLabel(product.stockQuantity) }}
            </span>
          </div>
          
          <div class="table-cell actions">
            <button class="action-btn edit" (click)="editProduct(product)" title="Edit Product">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
            
            <button class="action-btn delete" (click)="deleteProduct(product)" title="Delete Product">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredProducts.length === 0 && !isLoading">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
          <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
        </svg>
        <h3>No products found</h3>
        <p>Try adjusting your filters or start by adding your first product</p>
        <button class="add-btn" (click)="showAddProductForm()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
          Add First Product
        </button>
      </div>
      
      <!-- Pagination will be added back -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button class="page-btn" [disabled]="currentPage === 1">Previous</button>
        <span class="page-info">Page 1 of 1</span>
        <button class="page-btn" [disabled]="currentPage === totalPages">Next</button>
      </div>
    </div>
  </div>
</div>