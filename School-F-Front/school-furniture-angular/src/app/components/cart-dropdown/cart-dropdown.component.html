<!-- Cart Dropdown Backdrop -->
<div class="cart-backdrop" 
     [class.show]="isOpen" 
     (click)="onBackdropClick()"
     *ngIf="isOpen">
</div>

<!-- Cart Dropdown Panel -->
<div class="cart-dropdown" 
     [class.show]="isOpen"
     (click)="onDropdownClick($event)">
  
  <!-- Cart Header -->
  <div class="cart-header">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="cart-title mb-0">
        <i class="fas fa-shopping-cart me-2"></i>
        Shopping Cart
      </h5>
      <button type="button" 
              class="btn-close-cart" 
              (click)="closeDropdown.emit()"
              aria-label="Close cart">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="cart-summary-header mt-2">
      <span class="items-count">{{ cartSummary.totalItems }} items</span>
      <span class="total-price">${{ cartSummary.totalPrice | number:'1.2-2' }}</span>
    </div>
  </div>

  <!-- Cart Content -->
  <div class="cart-content">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="cart-loading text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 text-muted">Updating cart...</p>
    </div>

    <!-- Empty Cart -->
    <div *ngIf="!isLoading && cartItems.length === 0" class="empty-cart text-center py-5">
      <i class="fas fa-shopping-cart empty-cart-icon mb-3"></i>
      <h6 class="empty-cart-title">Your cart is empty</h6>
      <p class="empty-cart-text text-muted">Add some products to get started!</p>
      <button class="btn btn-primary btn-sm" (click)="closeDropdown.emit()">
        Continue Shopping
      </button>
    </div>

    <!-- Cart Items -->
    <div *ngIf="!isLoading && cartItems.length > 0" class="cart-items">
      <div *ngFor="let item of cartItems; trackBy: trackByProductId" 
           class="cart-item"
           [class.updating]="isItemUpdating(item.product.id)">
        
        <!-- Item Image -->
        <div class="item-image">
          <img [src]="item.product.imageUrl || 'assets/images/placeholder.jpg'" 
               [alt]="item.product.name"
               class="img-fluid">
        </div>

        <!-- Item Details -->
        <div class="item-details">
          <h6 class="item-name">{{ item.product.name }}</h6>
          <p class="item-category text-muted mb-1">{{ item.product.category }}</p>
          <div class="item-price-quantity">
            <span class="item-price">${{ item.product.price | number:'1.2-2' }}</span>
            
            <!-- Quantity Controls -->
            <div class="quantity-controls">
              <button class="btn btn-quantity" 
                      (click)="updateQuantity(item, item.quantity - 1)"
                      [disabled]="isItemUpdating(item.product.id)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="quantity-display">{{ item.quantity }}</span>
              <button class="btn btn-quantity" 
                      (click)="updateQuantity(item, item.quantity + 1)"
                      [disabled]="isItemUpdating(item.product.id)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          
          <!-- Item Total -->
          <div class="item-total">
            <strong>${{ getItemTotal(item) | number:'1.2-2' }}</strong>
          </div>
        </div>

        <!-- Remove Button -->
        <div class="item-actions">
          <button class="btn btn-remove" 
                  (click)="removeItem(item)"
                  [disabled]="isItemUpdating(item.product.id)"
                  title="Remove item">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>

        <!-- Loading Overlay -->
        <div *ngIf="isItemUpdating(item.product.id)" class="item-loading-overlay">
          <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">Updating...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Footer -->
  <div *ngIf="!isLoading && cartItems.length > 0" class="cart-footer">
    
    <!-- Cart Summary -->
    <div class="cart-summary mb-3">
      <div class="d-flex justify-content-between align-items-center">
        <span class="summary-label">Subtotal ({{ cartSummary.totalItems }} items):</span>
        <span class="summary-total">${{ cartSummary.totalPrice | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="cart-actions">
      <button class="btn btn-outline-secondary btn-sm me-2" 
              (click)="goToCart()">
        <i class="fas fa-shopping-cart me-1"></i>
        View Cart
      </button>
      
      <button class="btn btn-primary btn-sm flex-grow-1" 
              (click)="goToCheckout()">
        <i class="fas fa-credit-card me-1"></i>
        Checkout
      </button>
    </div>

    <!-- Clear Cart -->
    <div class="text-center mt-3">
      <button class="btn btn-link btn-sm text-danger" 
              (click)="clearCart()"
              [disabled]="isLoading">
        <i class="fas fa-trash me-1"></i>
        Clear Cart
      </button>
    </div>
  </div>
</div>